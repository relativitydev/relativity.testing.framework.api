<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Create a custom strategy </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Create a custom strategy ">
    <meta name="generator" content="docfx 2.59.4.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="../fusion/toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="create-a-custom-strategy">Create a custom strategy</h1>

<p>All strategies should be based on some interface, most common actions already have interfaces so you should check to see if one exists before duplicating it.
For a list of available interfaces, please check out the folder found <a href="https://github.com/relativitydev/relativity.testing.framework/tree/master/source/Relativity.Testing.Framework/Strategies">here</a>.</p>
<p>After you implement the needed interface you should register your strategy, in RTF we use the Castle Windsor package for it.
Let's say you want to implement a new get strategy for keyword search which uses a new model with fewer properties, named NewKeywordSearch.
For example, it can look like:</p>
<pre><code>[ObjectTypeName(&quot;KeywordSearch&quot;)]
public class NewKeywordSearch : NamedArtifact
{
}
</code></pre>
<p>And then you implement a new strategy, for example like this:</p>
<pre><code>public class NewGetByIdStrategy : IGetWorkspaceEntityByIdStrategy&lt;NewKeywordSearch&gt;
{
    public NewKeywordSearch Get(int workspaceId, int entityId)
    {
        return new NewKeywordSearch();
    }
}
</code></pre>
<p>Now you have a new strategy but RTF doesn't know how to resolve it.
For that, you need to implement a new class that will implement two interfaces: <a href="https://relativitydev.github.io/relativity.testing.framework/api/Relativity.Testing.Framework.IRelativityComponent.html">IRelativityComponent</a> and <a href="https://github.com/castleproject/Windsor/blob/master/docs/installers.md">IWindsorInstaller</a>.
In that class you can write some logic to register your strategies, lets name it TestComponent.</p>
<pre><code>public class TestComponent : IRelativityComponent, IWindsorInstaller
{
    public void Ensure(IWindsorContainer container)
    {
        // There is nothing to ensure here.
    }
 
    public void Initialize(IWindsorContainer container)
    {
        container.Install(this);
    }
 
    public void Install(IWindsorContainer container, IConfigurationStore store)
    {
        container.Register(Component.For&lt;IGetWorkspaceEntityByIdStrategy&lt;NewKeywordSearch&gt;&gt;().
            ImplementedBy&lt;NewGetByIdStrategy&gt;().
            LifestyleSingleton());
    }
}
</code></pre>
<p>Now we have a class wich can register our new strategy, to make this action you need to rely on this component before using strategy.
Better to do this action in OneTimeSetup like here, but you can do it even in the test like in the example below:</p>
<pre><code>[Test]
public void ResolveNewStrategy()
{
    RelativityFacade.Instance.RelyOn&lt;TestComponent&gt;();
    var service = RelativityFacade.Instance.Resolve&lt;IGetWorkspaceEntityByIdStrategy&lt;NewKeywordSearch&gt;&gt;();
 
    var keywordSearch = service.Get(-1, -1);
}
</code></pre>
<h1 id="create-a-custom-strategy-with-auto-clean-up">Create a custom strategy with auto clean up</h1>
<p>If you want to implement create a strategy with auto clean up then you should implement tho strategies: create and delete.
Create is a strategy that should be based on <a href="https://github.com/relativitydev/relativity.testing.framework.api/blob/master/source/Relativity.Testing.Framework.Api/Strategies/CreateWorkspaceEntityStrategy%601.cs">CreateWorkspaceEntityStrategy</a> for workspace artifacts or <a href="https://relativitydev.github.io/relativity.testing.framework/api/Relativity.Testing.Framework.Strategies.CreateStrategy-1.html">CreateStrategy</a> for admin artifacts.
Delete strategy should be based on <a href="https://relativitydev.github.io/relativity.testing.framework/api/Relativity.Testing.Framework.Strategies.DeleteByIdStrategy-1.html">DeleteByIdStrategy</a> for admin artifacts or <a href="https://relativitydev.github.io/relativity.testing.framework/api/Relativity.Testing.Framework.Strategies.DeleteWorkspaceEntityByIdStrategy-1.html">DeleteWorkspaceEntityByIdStrategy</a> for workspace artifacts.</p>
<pre><code>public class CustomDeleteStrategy : DeleteWorkspaceEntityByIdStrategy&lt;CustomModel&gt;
{
    protected override void DoDelete(int workspaceId, int entityId)
    {
        //some actions
    }
}
</code></pre>
<pre><code>public class CustomCreateStrategy : CreateWorkspaceEntityStrategy&lt;CustomModel&gt;
{
    protected override CustomModel DoCreate(int workspaceId, CustomModel entity)
    {
        //some actions
    }
}
</code></pre>
<p>If you implement this to strategies then this artifact will be removed in OneTimeTearDown or in TearDown.</p>
<hr>
<p><strong>NOTE</strong></p>
<p>Don't forget to register new strategies, and don't use for it abstract classes.
It's better to use the generic interfaces that already exist, when possible.
e.g. <a href="https://github.com/relativitydev/relativity.testing.framework.api/blob/master/source/Relativity.Testing.Framework.Api/Strategies/ICreateWorkspaceEntityStrategy%601.cs">ICreateWorkspaceEntityStrategy</a> for <a href="https://github.com/relativitydev/relativity.testing.framework.api/blob/master/source/Relativity.Testing.Framework.Api/Strategies/CreateWorkspaceEntityStrategy%601.cs">CreateWorkspaceEntityStrategy</a>.</p>
<hr>
<h1 id="using-rest-or-other-core-strategies-inside-of-the-custom-strategy">Using REST or other core strategies inside of the custom strategy</h1>
<p>Some times we need to use a different strategy inside of the strategy that we are creating.
To accomplish this, create a new constructor that will initialize the needed strategy.</p>
<pre><code>public class CustomCreateStrategy : CreateWorkspaceEntityStrategy&lt;CustomModel&gt;
{
    private readonly IRestService _restService;
 
    public CustomCreateStrategy (IRestService restService)
    {
        _restService = restService;
    }
 
    protected override CustomModel DoCreate(int workspaceId, CustomModel entity)
    {
        return _restService.Post&lt;int&gt;(&quot;Relativity.Services.Search.ISearchModule/Keyword%20Search%20Manager/CreateSingleAsync&quot;, entity);
    }
}
</code></pre>
<h1 id="using-interceptors">Using Interceptors</h1>
<p>Interceptors are used to provide functionality to strategies in a easy and scalable way.
The common <a href="/api/Relativity.Testing.Framework.Api.Interceptors.html">interceptors</a> get installed to most of the strategies when they are registered.</p>
<pre><code>public class TestComponent : IRelativityComponent, IWindsorInstaller
{
    private readonly Type[] _commonInterceptors = new[]
    {
        typeof(ApplicationInsightsInterceptor),
        typeof(LoggingInterceptor)
    };
     
    public void Ensure(IWindsorContainer container)
    {
        // There is nothing to ensure here.
    }
 
    public void Initialize(IWindsorContainer container)
    {
        container.Install(this);
    }
 
    public void Install(IWindsorContainer container, IConfigurationStore store)
    {
        container.Register(Component.For&lt;IGetWorkspaceEntityByIdStrategy&lt;NewKeywordSearch&gt;&gt;().
            ImplementedBy&lt;NewGetByIdStrategy&gt;().
            Interceptors(_commonInterceptors).
            LifestyleSingleton());
    }
}
</code></pre>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/relativitydev/relativity.testing.framework.api/blob/master/source/Relativity.Testing.Framework.Api.Documentation/articles/Using-Custom-Strategies.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
